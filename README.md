# Прогнозирование заказов такси в аэропортах  
**Модель машинного обучения для прогнозирования спроса на такси в следующий час**  

---

## Содержание  
1. [Описание проекта](#описание-проекта)  
2. [Технологии и инструменты](#технологии-и-инструменты)  
3. [Этапы работы](#этапы-работы)  
4. [Результаты](#результаты)  
5. [Ключевые выводы](#ключевые-выводы)  

---

## Описание проекта  
Цель проекта — разработка модели машинного обучения, которая прогнозирует количество заказов такси в аэропортах в следующий час на основе исторических данных с марта по август 2018 года.  

**Зачем это нужно?**  
- Позволяет таксопаркам эффективно распределять водителей в периоды пиковой нагрузки  
- Минимизирует время ожидания клиентов и простои водителей  
- Повышает удовлетворенность клиентов и рентабельность таксопарка  
- Демонстрирует применение временных рядов для решения реальных бизнес-задач  

**Данные:**  
- Исторические данные о заказах такси за период с 1 марта по 31 августа 2018 года  
- Исходный датасет: 26,496 записей (10-минутные интервалы)  
- После ресемплирования: 4,416 записей (часовые интервалы)  
- Диапазон заказов: 0-200 заказов в час, среднее значение 50-90 заказов  

---

## Технологии и инструменты  
- **Python**: `pandas`, `numpy`, `scikit-learn`, `catboost`, `prophet`, `statsmodels`
- **Визуализация**: `Matplotlib`, `Seaborn`, `SHAP`  
- **Оптимизация**: `OptunaSearchCV`, `RandomizedSearchCV`  
- **Анализ временных рядов**: Автокорреляционный анализ, выявление трендов и сезонности  
- **Метрика качества**: RMSE (Root Mean Squared Error) с порогом 48  

---

## Этапы работы  
### 1. Подготовка данных  
- **Ресемплирование данных**: преобразование 10-минутных интервалов в почасовые (26,496 → 4,416 записей)  
- **Проверка данных**: отсутствие пропусков, корректность типов данных  
- **Создание признаков**:  
  - Временные признаки: `hour`, `month`, `day`, `is_weekend`  
  - Лаги: `lag_1`–`lag_168` (до недельного периода)  
  - Скользящее среднее: `rolling_mean_6` (за 6 часов)  

### 2. Анализ данных  
- **Трендовый анализ**: выявление восходящего тренда (с 50 заказов/час в марте до 168 в августе)  
- **Сезонный анализ**:  
  - Дневная сезонность: пик в ночные часы (23:00–04:00), минимум утром (5:00–8:00)  
  - Недельная сезонность: повышенный спрос по пятницам (медиана 87 заказов)  
  - Годовая сезонность: рост спроса в летние месяцы (август — пик)  
- **Корреляционный анализ**: сильная связь с признаком `hour`, слабая с `day_of_week` (удален)  

### 3. Моделирование  
- **Подготовка выборок**: 90% обучающая выборка, 10% тестовая (без перемешивания для сохранения временного порядка)  
- **Тестирование моделей**:  
  - Baseline (Ridge регрессия)  
  - CatBoostRegressor  
  - Prophet (модель временных рядов от Facebook)  
- **Оптимизация**:  
  - Для Ridge: RandomizedSearchCV с подбором скалеров и параметров  
  - Для CatBoost: OptunaSearchCV с подбором 11 гиперпараметров  
- **Оценка моделей**: RMSE на тестовой выборке  

---

## Результаты  
- **Лучшая модель**: CatBoost с RMSE = **36** на тестовой выборке (значительно ниже целевого порога 48)  
- **Baseline (Ridge)**: RMSE ≈ 22 на валидации  
- **Prophet**: RMSE = 48.31 (чуть превысил порог)  

| Модель | Валидация RMSE | Тестовая RMSE |
|---|---|---|
| CatBoost | ~21 | **36** |
| Ridge (Baseline) | ~22 | - |
| Prophet | - | 48.31 |

**Анализ важности признаков (SHAP):**  
- Самый важный признак: `lag_168` (количество заказов ровно неделю назад)  
- Другие значимые признаки: `lag_24`, `lag_48`, `lag_1`, `hour`, `rolling_mean_6`  
- Модель эффективно уловила как дневные, так и недельные паттерны спроса  

---

## Ключевые выводы  
1. **Паттерны спроса**:  
   - Сезонный рост спроса летом (особенно в августе)  
   - Пиковые часы: 23:00–04:00  
   - Повышенный спрос по пятницам  

2. **Эффективность модели**:  
   - CatBoost превосходит другие методы благодаря способности улавливать сложные нелинейные зависимости  
   - Лаговые признаки (особенно недельные) оказались критически важными для точного прогноза  

3. **Бизнес-рекомендации**:  
   - **Оптимизация распределения водителей**: Увеличить количество водителей в ночные часы (23:00–04:00) и в летние месяцы, особенно в августе  
   - **Внедрение модели**: Использовать CatBoost для ежечасного прогнозирования спроса  
   - **Расширение модели**: Добавить внешние факторы (погода, расписание рейсов, праздники) для дальнейшего повышения точности  
   - **Поддержание модели**: Регулярное обновление данными и мониторинг производительности в реальных условиях  

**Дальнейшие улучшения**:  
- Интеграция данных о погоде и праздниках  
- Учет специфических событий (конференции, спортивные мероприятия)  

Этот проект демонстрирует, как анализ временных рядов и машинное обучение могут помочь в оптимизации бизнес-процессов, повышая эффективность распределения ресурсов и удовлетворенность клиентов.
